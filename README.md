# A股智能投资分析系统

基于LangChain和OpenAI的多Agent智能分析平台，实时展示A股投资分析过程。

## 系统架构

```
stock_agent/
├── config.py                    # 配置文件
├── base_agent.py               # Agent基类
├── stock_agent.py              # 主协调器
├── api.py                      # Web API服务
├── agents/                     # 各专业Agent
│   ├── technical_analyst.py    # 技术分析师
│   ├── fundamental_analyst.py  # 基本面分析师
│   ├── risk_manager.py         # 风险控制专家
│   ├── sentiment_analyst.py    # 市场情绪分析师
│   └── investment_strategist.py # 投资策略师
├── tools/                      # 工具模块
│   ├── data_fetcher.py        # 数据获取工具
│   ├── stock_analyzer.py      # 股票分析工具
│   ├── backtest_engine.py     # 回测引擎
│   └── backtest_visualizer.py # 回测可视化
├── web/                        # Web界面
│   ├── templates/
│   │   └── index.html         # 主页面
│   └── static/
│       ├── css/
│       │   └── style.css      # 样式文件
│       └── js/
│           └── app.js         # 前端逻辑
├── requirements.txt           # 依赖包
└── .env.example              # 环境变量示例
```

## Agent人格设定

### 1. 技术分析师 - 张技术
- **专业背景**: 15年A股技术分析经验
- **专业领域**: K线形态、技术指标、趋势分析、量价关系
- **性格特点**: 严谨、数据驱动、注重趋势和形态
- **核心能力**: 
  - K线形态识别（头肩顶底、双顶双底、三角形整理等）
  - 技术指标分析（MACD、KDJ、RSI、BOLL等）
  - 趋势判断和拐点识别
  - 量价关系分析

### 2. 基本面分析师 - 李价值
- **专业背景**: CFA持证人，12年证券研究经验
- **专业领域**: 财务报表分析、估值模型、行业研究、公司治理
- **性格特点**: 稳健、理性、注重长期价值
- **核心能力**:
  - 财务报表分析（资产负债表、利润表、现金流量表）
  - 估值模型应用（PE、PB、PEG、DCF等）
  - 行业竞争格局分析
  - 公司治理和管理层评估

### 3. 风险控制专家 - 王风控
- **专业背景**: 风险管理师，10年券商风控经验
- **专业领域**: 市场风险评估、仓位管理、止损策略、压力测试
- **性格特点**: 保守、谨慎、风险厌恶
- **核心能力**:
  - 市场风险评估（系统性风险、非系统性风险）
  - 仓位管理和资金配置
  - 止损策略制定
  - 黑天鹅事件预警

### 4. 市场情绪分析师 - 赵情绪
- **专业背景**: 行为金融学博士，8年市场情绪研究经验
- **专业领域**: 市场情绪、资金流向、舆情分析、行为金融
- **性格特点**: 敏锐、直觉强、善于捕捉市场情绪变化
- **核心能力**:
  - 市场情绪指标分析（恐慌指数、投资者情绪指数）
  - 资金流向追踪（北向资金、主力资金）
  - 舆情和新闻事件影响评估
  - 羊群效应识别

### 5. 投资策略师 - 陈策略
- **专业背景**: 资深投资顾问，20年A股投资经验
- **专业领域**: 投资策略制定、资产配置、投资组合优化、综合分析
- **性格特点**: 全面、平衡、决策果断
- **核心能力**:
  - 多维度信息整合
  - 投资策略制定（短线、中线、长线）
  - 资产配置建议
  - 投资组合优化

## 快速开始

### 1. 环境准备
确保已安装 Python 3.8 或更高版本

### 2. 安装依赖
```bash
pip install -r requirements.txt
```

### 3. 配置API密钥
复制环境变量示例文件：
```bash
cp .env.example .env
```

编辑 `.env` 文件，填入你的OpenAI API密钥：
```
OPENAI_API_KEY=your_openai_api_key_here
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_MODEL=gpt-4
FLASK_SECRET_KEY=your_secret_key_here
FLASK_DEBUG=True
```

### 4. 启动服务
```bash
python api.py
```

### 5. 访问系统
在浏览器中打开：`http://localhost:5000`

## 使用说明

### 基本分析流程
1. 在浏览器中打开 `http://localhost:5000`
2. 在输入框中输入6位股票代码（如：600519）
3. 点击"开始分析"按钮
4. 系统将实时展示5个Agent的分析过程
5. 分析完成后，查看各Agent的详细分析报告和最终投资策略

### K线周期切换
- 点击"日K"、"周K"、"月K"按钮切换不同周期的K线图
- 系统会自动加载对应周期的历史数据
- 技术指标会根据当前周期重新计算

### 回测功能
1. 完成股票分析后，点击导航栏的"回测分析"
2. 系统会自动基于当前策略进行回测
3. 查看回测结果：权益曲线、最大回撤、交易分布等
4. 可以下载回测报告

### 对比分析
1. 点击导航栏的"对比分析"
2. 输入要对比的股票代码，点击"添加"
3. 可以添加多只股票进行对比
4. 查看价格走势、收益率对比和指标雷达图

### 投资组合分析
1. 点击导航栏的"投资组合"
2. 输入股票代码和权重，点击"添加股票"
3. 构建多股票投资组合
4. 查看组合配置、表现、风险指标和相关性分析

## 功能特性

### 核心功能
- 实时WebSocket通信，展示分析进度
- 5个专业Agent并行分析
- 美观的Web界面，支持响应式设计
- 历史分析记录功能
- 完整的分析报告格式

### K线分析
- 支持日K、周K、月K三种周期切换
- 实时K线图表展示
- 技术指标叠加（MA5/MA10/MA20/MA30）
- 成交量分析
- 股票基本信息展示（价格、涨跌幅、成交量等）

### 技术分析图表
- 成交量趋势分析
- MACD技术指标分析
- RSI相对强弱指标
- 投资组合配置分析

### 回测系统
- 基于策略信号的自动回测
- 权益曲线可视化
- 最大回撤分析
- 交易分布统计
- 性能指标雷达图
- 详细交易记录表格
- 回测报告导出功能

### 对比分析
- 多股票价格走势对比
- 标准化收益率对比
- 多维度指标雷达图对比
- 统计分析（最高/最低/平均收益率）

### 投资组合分析
- 投资组合配置可视化
- 组合表现分析
- 风险指标雷达图
- 股票相关性热力图
- 组合统计指标（累计收益、年化收益、夏普比率）

### 多用户支持
- 基于Session ID的用户隔离
- 支持多用户同时在线分析
- WebSocket房间机制
- 自动重连和心跳保活

## 技术栈

### 后端技术
- **Web框架**: Flask 3.0+
- **实时通信**: Flask-SocketIO 5.3+, eventlet
- **AI框架**: LangChain 0.1.0+, OpenAI 1.10.0+
- **数据处理**: Pandas 2.0.0+, NumPy 1.24.0+
- **数据源**: AkShare 1.12.0+ (A股实时数据)
- **环境配置**: python-dotenv

### 前端技术
- **基础**: HTML5, CSS3, JavaScript (ES6+)
- **图表库**: ECharts 5.x
- **实时通信**: Socket.IO Client
- **响应式设计**: Flexbox, Grid Layout
- **动画效果**: CSS Transitions, Keyframes

### 核心特性
- **多Agent架构**: 基于LangChain的并行分析
- **WebSocket通信**: 实时进度推送和状态更新
- **会话管理**: Session ID隔离，支持多用户
- **自动重连**: 心跳保活机制，断线自动重连
- **数据可视化**: ECharts交互式图表
- **回测引擎**: 基于历史数据的策略回测

## 注意事项

1. 需要有效的OpenAI API密钥
2. 首次运行需要安装所有依赖包
3. 数据获取依赖网络连接
4. 分析过程可能需要几分钟时间
5. 建议使用Chrome或Edge浏览器以获得最佳体验
6. 公网部署时需要配置CORS和防火墙规则

## 项目亮点

- 智能多Agent协作：5个专业AI Agent并行分析，模拟真实投资团队协作
- 实时可视化：WebSocket实时推送分析进度，让用户了解每一步分析过程
- 专业级回测：基于历史数据的完整回测系统，支持多种性能指标
- 多维度分析：技术面、基本面、情绪面、风险面全方位覆盖
- 用户友好：现代化UI设计，响应式布局，支持多种设备访问
- 可扩展架构：模块化设计，易于添加新的Agent和功能模块

## 未来规划

- [ ] 增加更多技术指标和图表类型
- [ ] 支持美股、港股等更多市场
- [ ] 添加机器学习预测模型
- [ ] 实现自动交易信号推送
- [ ] 增加移动端App
- [ ] 支持自定义策略回测
- [ ] 添加社区分享功能
- [ ] 实现多语言支持

## License

MIT License
